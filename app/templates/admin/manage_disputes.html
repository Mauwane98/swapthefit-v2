{% extends "_layouts/base.html" %}

{% block title %}Manage Disputes{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="text-center mb-5">
        <h1 class="display-5 fw-bold">Manage Disputes</h1>
        <p class="lead">Review and resolve user disputes.</p>
    </div>

    <div class="card shadow-sm border-0">
        <div class="card-header bg-white p-3 d-flex justify-content-between align-items-center">
            <div class="btn-group" role="group">
                <a href="{{ url_for('disputes.manage_disputes', status='all') }}" class="btn {% if status_filter == 'all' %}btn-primary{% else %}btn-secondary{% endif %}">All</a>
                <a href="{{ url_for('disputes.manage_disputes', status='open') }}" class="btn {% if status_filter == 'open' %}btn-danger{% else %}btn-secondary{% endif %}">Open</a>
                <a href="{{ url_for('disputes.manage_disputes', status='under review') }}" class="btn {% if status_filter == 'under review' %}btn-warning{% else %}btn-secondary{% endif %}">Under Review</a>
                <a href="{{ url_for('disputes.manage_disputes', status='resolved') }}" class="btn {% if status_filter == 'resolved' %}btn-success{% else %}btn-secondary{% endif %}">Resolved</a>
                <a href="{{ url_for('disputes.manage_disputes', status='closed') }}" class="btn {% if status_filter == 'closed' %}btn-dark{% else %}btn-secondary{% endif %}">Closed</a>
            </div>
        </div>
        <div class="table-responsive">
            <table class="table table-hover mb-0">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Initiator</th>
                        <th>Respondent</th>
                        <th>Listing</th>
                        <th>Reason</th>
                        <th>Status</th>
                        <th>Date Raised</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for dispute in disputes %}
                    <tr>
                        <td>{{ dispute.id }}</td>
                        <td><a href="{{ url_for('listings.user_profile', user_id=dispute.initiator.id) }}">{{ dispute.initiator.username }}</a></td>
                        <td><a href="{{ url_for('listings.user_profile', user_id=dispute.respondent.id) }}">{{ dispute.respondent.username }}</a></td>
                        <td>
                            {% if dispute.listing %}
                                <a href="{{ url_for('listings.listing_detail', listing_id=dispute.listing.id) }}">{{ dispute.listing.title }}</a>
                            {% else %}
                                N/A
                            {% endif %}
                        </td>
                        <td class="text-truncate" style="max-width: 200px;">{{ dispute.reason }}</td>
                        <td>
                            <span class="badge 
                                {% if dispute.status == 'open' %}bg-danger
                                {% elif dispute.status == 'under review' %}bg-warning text-dark
                                {% elif dispute.status == 'resolved' %}bg-success
                                {% else %}bg-dark{% endif %}">{{ dispute.status|capitalize }}</span>
                        </td>
                        <td>{{ dispute.date_raised.strftime('%b %d, %Y') }}</td>
                        <td>
                            <a href="{{ url_for('disputes.resolve_dispute', dispute_id=dispute.id) }}" class="btn btn-sm btn-primary">Manage</a>
                            <a href="{{ url_for('disputes.dispute_detail', dispute_id=dispute.id) }}" class="btn btn-sm btn-secondary">View</a>
                            {% if dispute.respondent.active %}
                            <form action="{{ url_for('admin_bp.suspend_user', user_id=dispute.respondent.id) }}" method="POST" class="d-inline">
                                {{ csrf_token() | safe }}
                                <button type="submit" class="btn btn-sm btn-warning ms-1" onclick="return confirm('Are you sure you want to suspend this user?');">Suspend Respondent</button>
                            </form>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% if not disputes %}
            <div class="card-body text-center">
                <p class="text-muted mb-0">No disputes found.</p>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}