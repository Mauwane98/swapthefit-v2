{% extends "_layouts/base.html" %}

{% block title %}Edit Listing{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8 md:py-12">
    <div class="max-w-3xl mx-auto bg-white p-8 rounded-lg shadow-xl border border-gray-200">
        <div class="text-center mb-8">
            <h1 class="text-3xl font-extrabold text-gray-900">Edit Your Listing</h1>
            <p class="mt-2 text-base text-gray-600">Update the details for your item below.</p>
        </div>

        <form method="POST" action="{{ url_for('listings.edit_listing', listing_id=listing.id) }}" enctype="multipart/form-data" class="space-y-6">
            {{ form.hidden_tag() }}

            <!-- Listing Title -->
            <div>
                {{ form.title.label(class="block text-sm font-semibold text-gray-700 mb-1") }}
                {{ form.title(class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-accent focus:border-accent sm:text-sm") }}
                {% for error in form.title.errors %}
                    <span class="text-red-500 text-xs mt-1 block">{{ error }}</span>
                {% endfor %}
            </div>

            <!-- Description -->
            <div>
                {{ form.description.label(class="block text-sm font-semibold text-gray-700 mb-1") }}
                {{ form.description(class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-accent focus:border-accent sm:text-sm h-32 resize-y") }}
                {% for error in form.description.errors %}
                    <span class="text-red-500 text-xs mt-1 block">{{ error }}</span>
                {% endfor %}
            </div>

            <!-- Category, Size, Condition in a grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    {{ form.category.label(class="block text-sm font-semibold text-gray-700 mb-1") }}
                    {{ form.category(class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-accent focus:border-accent sm:text-sm rounded-md") }}
                    {% for error in form.category.errors %}
                        <span class="text-red-500 text-xs mt-1 block">{{ error }}</span>
                    {% endfor %}
                </div>
                <div>
                    {{ form.size.label(class="block text-sm font-semibold text-gray-700 mb-1") }}
                    {{ form.size(class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-accent focus:border-accent sm:text-sm") }}
                    {% for error in form.size.errors %}
                        <span class="text-red-500 text-xs mt-1 block">{{ error }}</span>
                    {% endfor %}
                </div>
                <div>
                    {{ form.condition.label(class="block text-sm font-semibold text-gray-700 mb-1") }}
                    {{ form.condition(class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-accent focus:border-accent sm:text-sm rounded-md") }}
                    {% for error in form.condition.errors %}
                        <span class="text-red-500 text-xs mt-1 block">{{ error }}</span>
                    {% endfor %}
                </div>
                <div>
                    {{ form.school_name.label(class="block text-sm font-semibold text-gray-700 mb-1") }}
                    {{ form.school_name(class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-accent focus:border-accent sm:text-sm") }}
                    {% for error in form.school_name.errors %}
                        <span class="text-red-500 text-xs mt-1 block">{{ error }}</span>
                    {% endfor %}
                </div>
            </div>

            <!-- Desired Swap Items -->
            <div>
                {{ form.desired_swap_items.label(class="block text-sm font-semibold text-gray-700 mb-1") }}
                {{ form.desired_swap_items(class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-accent focus:border-accent sm:text-sm h-24 resize-y") }}
                {% for error in form.desired_swap_items.errors %}
                    <span class="text-red-500 text-xs mt-1 block">{{ error }}</span>
                {% endfor %}
            </div>

            <!-- Current Photos Display -->
            {% if listing.images %}
            <div class="mb-6">
                <p class="block text-sm font-semibold text-gray-700 mb-2">Current Photos:</p>
                <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
                    {% for image_url in listing.images %}
                        <div class="relative group">
                            <img src="{{ image_url }}" alt="Current Listing Photo" class="w-full h-24 object-cover rounded-md shadow-sm border border-gray-200">
                            <!-- Optional: Add a way to remove individual photos if needed -->
                            <!-- <button type="button" class="absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 text-xs opacity-0 group-hover:opacity-100 transition-opacity">
                                <i class="fas fa-times"></i>
                            </button> -->
                        </div>
                    {% endfor %}
                </div>
                <p class="mt-2 text-xs text-gray-500">Uploading new photos will replace the current ones.</p>
            </div>
            {% endif %}

            <!-- Photos Upload -->
            <div>
                {{ form.photos.label(class="block text-sm font-semibold text-gray-700 mb-1") }}
                <input type="file" name="{{ form.photos.name }}" id="{{ form.photos.id }}" multiple 
                       class="block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 focus:outline-none file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-accent file:text-white hover:file:bg-[#2F9C6E]">
                <p class="mt-1 text-xs text-gray-500">Upload up to 5 new photos. Max file size: 2MB per image. Formats: JPG, PNG, JPEG.</p>
                {% for error in form.photos.errors %}
                    <span class="text-red-500 text-xs mt-1 block">{{ error }}</span>
                {% endfor %}
            </div>

            <!-- Submit Button -->
            <div>
                <button type="submit" class="group relative w-full flex justify-center py-2.5 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-[var(--color-accent)] hover:bg-[#2F9C6E] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[var(--color-accent)] transition-all duration-300 shadow-md">
                    <i class="fas fa-save mr-2"></i> Update Listing
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}
