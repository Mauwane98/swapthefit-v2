{% extends "_layouts/base.html" %}

{% block title %}Propose Swap{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8 md:py-12">
    <div class="max-w-3xl mx-auto bg-white p-8 rounded-lg shadow-xl border border-gray-200">
        <div class="text-center mb-8 pb-4 border-b border-gray-200">
            <h1 class="text-3xl font-extrabold text-gray-900">Propose a Swap</h1>
            <p class="mt-2 text-base text-gray-600">Offer one of your listings in exchange for this item.</p>
        </div>

        <div class="mb-8">
            <h2 class="text-xl font-bold text-gray-900 mb-4">Item You Want:</h2>
            <div class="flex flex-col sm:flex-row items-center bg-gray-50 p-4 rounded-lg border border-gray-200 shadow-sm">
                <img src="{{ requested_listing.images[0] if requested_listing.images else 'https://placehold.co/100x100/E0E0E0/888888?text=No+Image' }}" 
                     alt="{{ requested_listing.title }}" 
                     class="w-24 h-24 object-cover rounded-md mr-4 mb-4 sm:mb-0">
                <div>
                    <h3 class="text-lg font-semibold text-gray-900">{{ requested_listing.title }}</h3>
                    <p class="text-sm text-gray-600">Category: {{ requested_listing.category }} | Size: {{ requested_listing.size }}</p>
                    <p class="text-sm text-gray-600">Condition: {{ requested_listing.condition }}</p>
                    <a href="{{ url_for('listings.listing_detail', listing_id=requested_listing.id) }}" 
                       class="text-[var(--color-accent)] hover:underline text-sm font-medium mt-1 inline-block">View Details</a>
                </div>
            </div>
        </div>

        <form method="POST" action="{{ url_for('swaps.propose_swap', listing_id=requested_listing.id) }}" class="space-y-6">
            {{ csrf_token() }} {# CSRF token for security #}

            <h2 class="text-xl font-bold text-gray-900 mb-4">Your Item to Offer:</h2>
            {% if user_listings %}
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    {% for listing in user_listings %}
                        <label for="offered_listing_{{ listing.id }}" class="flex items-center p-4 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors duration-200 has-[:checked]:border-[var(--color-accent)] has-[:checked]:bg-blue-50">
                            <input type="radio" name="offered_listing_id" id="offered_listing_{{ listing.id }}" 
                                   value="{{ listing.id }}" class="h-4 w-4 text-[var(--color-accent)] focus:ring-[var(--color-accent)] border-gray-300">
                            <img src="{{ listing.images[0] if listing.images else 'https://placehold.co/80x80/E0E0E0/888888?text=No+Image' }}" 
                                 alt="{{ listing.title }}" 
                                 class="w-16 h-16 object-cover rounded-md ml-3 mr-4">
                            <div>
                                <h3 class="text-md font-semibold text-gray-900">{{ listing.title }}</h3>
                                <p class="text-sm text-gray-600">Size: {{ listing.size }} | Condition: {{ listing.condition }}</p>
                            </div>
                        </label>
                    {% endfor %}
                </div>
            {% else %}
                <p class="text-center text-gray-600 py-6">You have no available listings to offer for a swap.</p>
                <div class="text-center">
                    <a href="{{ url_for('listings.create_listing') }}" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-[var(--color-accent)] hover:bg-[#2F9C6E] shadow-sm">
                        <i class="fas fa-plus mr-2"></i> Create a Listing to Offer
                    </a>
                </div>
            {% endif %}

            <div class="mt-6">
                <button type="submit" class="group relative w-full flex justify-center py-2.5 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-[var(--color-accent)] hover:bg-[#2F9C6E] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[var(--color-accent)] transition-all duration-300 shadow-md">
                    <i class="fas fa-paper-plane mr-2"></i> Send Swap Request
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}
