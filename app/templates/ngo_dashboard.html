{% extends '_layouts/base.html' %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold text-gray-800 mb-6 rounded-lg p-3 bg-green-100 shadow-md text-center">
        NGO Dashboard
    </h1>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Donations Management Section -->
        <div class="bg-white p-6 rounded-lg shadow-lg border border-gray-200">
            <h2 class="text-2xl font-semibold text-gray-700 mb-4 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 14v6m-3-3h6M6 10h2a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v2a2 2 0 002 2zm10 0h2a2 2 0 002-2V6a2 2 0 00-2-2h-2a2 2 0 00-2 2v2a2 2 0 002 2zM6 20h2a2 2 0 002-2v-2a2 2 0 00-2-2H6a2 2 0 00-2 2v2a2 2 0 002 2z" />
                </svg>
                Donations Management
            </h2>
            <p class="text-gray-600 mb-4">Oversee all donated items received and process them for distribution.</p>
            <a href="{{ url_for('donations.manage_donations') }}" class="inline-block bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300">
                View All Donations
            </a>
            <ul class="mt-4 space-y-2 text-gray-600">
                <li class="flex items-center">
                    <span class="font-medium mr-2">New Pending Donations:</span> <span class="text-yellow-600 font-bold">{{ received_donations.filter(status='pending_pickup').count() }}</span>
                </li>
                <li class="flex items-center">
                    <span class="font-medium mr-2">Total Received Items:</span> <span class="text-green-600 font-bold">{{ total_received_items }}</span>
                </li>
            </ul>
            {% if received_donations %}
                <ul class="mt-4 space-y-2">
                    {% for donation in received_donations|slice(':3') %}
                        <li class="flex items-center bg-gray-50 p-3 rounded-md shadow-sm">
                            <img src="{{ donation.donated_listing.images[0] }}" alt="{{ donation.donated_listing.title }}" class="h-10 w-10 object-cover rounded-md mr-3">
                            <div>
                                <a href="{{ url_for('donations.view_donation_request', donation_id=donation.id) }}" class="text-green-600 hover:underline font-medium">{{ donation.donated_listing.title }}</a>
                                <p class="text-sm text-gray-500">From: {{ donation.donor.username }} - Status: {{ donation.status|replace('_', ' ')|capitalize }}</p>
                            </div>
                        </li>
                    {% endfor %}
                    {% if received_donations|length > 3 %}
                        <li class="text-center mt-3">
                            <a href="{{ url_for('donations.manage_donations') }}" class="text-green-500 hover:underline text-sm">View All Donations &rarr;</a>
                        </li>
                    {% endif %}
                </ul>
            {% else %}
                <p class="text-gray-500 text-sm">No donations have been received by your organization yet.</p>
            {% endif %}
            <h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Logistics Status Overview (Donations)</h3>
            <ul class="space-y-2 text-gray-600">
                {% for donation in received_donations %}
                    {% if donation.logistics_status != 'delivered' and donation.logistics_status != 'failed' %}
                        <li class="flex items-center justify-between bg-gray-100 p-2 rounded-md">
                            <span class="text-sm">Donation of "{{ donation.donated_listing.title }}"</span>
                            <a href="{{ url_for('logistics.view_logistics', transaction_type='donation', transaction_id=donation.id) }}" class="text-blue-500 hover:underline text-sm">
                                Status: {{ donation.logistics_status|replace('_', ' ')|capitalize }} &rarr;
                            </a>
                        </li>
                    {% endif %}
                {% endfor %}
                {% if not received_donations %}
                    <li class="text-gray-500 text-sm">No active logistics for donations.</li>
                {% endif %}
            </ul>
        </div>

        <!-- Impact & Reports Section -->
        <div class="bg-white p-6 rounded-lg shadow-lg border border-gray-200">
            <h2 class="text-2xl font-semibold text-gray-700 mb-4 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                </svg>
                Impact & Reporting
            </h2>
            <p class="text-gray-600 mb-4">Generate reports on your distribution efforts and measure the impact of your work.</p>
            <a href="{{ url_for('donations.manage_donations') }}" class="inline-block bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300">
                View Distribution Records
            </a>
            <ul class="mt-4 space-y-2 text-gray-600">
                <li class="flex items-center">
                    <span class="font-medium mr-2">Items Distributed (YTD):</span> <span class="text-blue-600 font-bold">{{ total_distributed_items }}</span>
                </li>
                <li class="flex items-center">
                    <span class="font-medium mr-2">Families Supported (YTD):</span> <span class="text-indigo-600 font-bold">0</span> {# Placeholder: Requires a separate model/logic to track families #}
                </li>
            </ul>
            <p class="text-sm text-gray-500 mt-2">Comprehensive impact reporting features under development.</p>
        </div>
    </div>
</div>
{% endblock %}
