{% extends "_layouts/base.html" %}

{% block title %}Manage Donations{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="text-center mb-5">
        <h1 class="display-5 fw-bold">Manage Donations</h1>
        <p class="lead">Track your sent and received donations.</p>
    </div>

    <div class="row">
        <!-- Sent Donations -->
        <div class="col-lg-6 mb-4">
            <div class="card h-100 shadow-sm border-0">
                <div class="card-body p-4">
                    <h4 class="card-title fw-bold mb-3">My Sent Donations</h4>
                    {% if sent_donations %}
                        <ul class="list-group list-group-flush">
                            {% for donation in sent_donations %}
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="mb-1">{{ donation.donated_listing.title }}</h6>
                                    <small class="text-muted">To: {{ donation.recipient.username }}</small><br>
                                    <small class="text-muted">Status: <span class="badge bg-info">{{ donation.status|replace('_', ' ')|capitalize }}</span></small>
                                </div>
                                <a href="{{ url_for('donations.view_donation_request', donation_id=donation.id) }}" class="btn btn-sm btn-secondary">View Details</a>
                            </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <p class="text-muted">You haven't proposed any donations yet.</p>
                        <a href="{{ url_for('listings.marketplace', listing_type='donation') }}" class="btn btn-primary mt-3">Find items to Donate</a>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Received Donations (for School/NGO roles) -->
        {% if current_user.has_role('school') or current_user.has_role('ngo') %}
        <div class="col-lg-6 mb-4">
            <div class="card h-100 shadow-sm border-0">
                <div class="card-body p-4">
                    <h4 class="card-title fw-bold mb-3">Received Donations</h4>
                    {% if received_donations %}
                        <ul class="list-group list-group-flush">
                            {% for donation in received_donations %}
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="mb-1">{{ donation.donated_listing.title }}</h6>
                                    <small class="text-muted">From: {{ donation.donor.username }}</small><br>
                                    <small class="text-muted">Status: <span class="badge 
                                        {% if donation.status == 'pending_pickup' %}bg-warning text-dark
                                        {% elif donation.status == 'received' %}bg-info
                                        {% elif donation.status == 'distributed' %}bg-success
                                        {% endif %}">{{ donation.status|replace('_', ' ')|capitalize }}</span></small>
                                </div>
                                <a href="{{ url_for('donations.view_donation_request', donation_id=donation.id) }}" class="btn btn-sm btn-primary">View Details</a>
                            </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <p class="text-muted">No donations have been received by your organization yet.</p>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}