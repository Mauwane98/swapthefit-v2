{% extends "_layouts/base.html" %}

{% block title %}Create an Account{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="row justify-content-center">
        <div class="col-lg-6">
            <div class="card shadow-lg border-0">
                <div class="card-body p-5">
                    <h1 class="h3 fw-bold text-center mb-4">Create your free account</h1>
                    
                    <form method="POST" action="{{ url_for('auth.register') }}">
                        {{ form.hidden_tag() }}
                        
                        <div class="mb-4">
                            <label class="form-label">{{ form.role.label }}</label>
                            <div class="row g-2">
                                {% for subfield in form.role %}
                                <div class="col-4">
                                    <div class="form-check">
                                        {{ subfield(class="form-check-input d-none", id=subfield.id) }}
                                        <label class="form-check-label" for="{{ subfield.id }}">{{ subfield.label.text }}</label>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                            {% for error in form.role.errors %}
                                <div class="invalid-feedback d-block">{{ error }}</div>
                            {% endfor %}
                        </div>

                        <div class="mb-3">
                            {{ form.username.label(id="username-label", class="form-label") }}
                            {{ form.username(class="form-control form-control-lg") }}
                            {% for error in form.username.errors %}
                                <div class="invalid-feedback d-block">{{ error }}</div>
                            {% endfor %}
                        </div>
                        
                        <div id="contact-person-field" class="mb-3 d-none">
                            {{ form.contact_person.label(class="form-label") }}
                            {{ form.contact_person(class="form-control form-control-lg", placeholder="e.g., Jane Doe, Main Contact") }}
                            {% for error in form.contact_person.errors %}
                                <div class="invalid-feedback d-block">{{ error }}</div>
                            {% endfor %}
                        </div>
                        
                        <div class="mb-3">
                            {{ form.email.label(class="form-label") }}
                            {{ form.email(class="form-control form-control-lg", placeholder="you@example.com") }}
                            {% for error in form.email.errors %}
                                <div class="invalid-feedback d-block">{{ error }}</div>
                            {% endfor %}
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                {{ form.password.label(class="form-label") }}
                                {{ form.password(class="form-control form-control-lg", placeholder="Create a password") }}
                                {% for error in form.password.errors %}
                                    <div class="invalid-feedback d-block">{{ error }}</div>
                                {% endfor %}
                            </div>
                            <div class="col-md-6 mb-3">
                                {{ form.confirm_password.label(class="form-label") }}
                                {{ form.confirm_password(class="form-control form-control-lg", placeholder="Confirm password") }}
                                {% for error in form.confirm_password.errors %}
                                    <div class="invalid-feedback d-block">{{ error }}</div>
                                {% endfor %}
                            </div>
                        </div>

                        <div class="d-grid mb-3">
                            <button type="submit" class="btn btn-primary btn-lg">Create Account</button>
                        </div>

                        <div class="d-grid">
                            <a href="{{ url_for('google_login') }}" class="btn btn-secondary btn-lg">
                                <img src="https://www.svgrepo.com/show/355037/google.svg" alt="Google logo" style="height: 1.2em;" class="me-2">
                                Sign up with Google
                            </a>
                        </div>
                    </form>

                    <p class="mt-4 text-center">
                        Already have an account? <a href="{{ url_for('auth.login') }}" class="text-decoration-none fw-bold">Sign in</a>
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', () => {
    const roleRadios = document.querySelectorAll('input[name="role"]');
    const usernameLabel = document.getElementById('username-label');
    const usernameInput = document.querySelector('[name="username"]');
    const contactPersonField = document.getElementById('contact-person-field');
    const contactPersonInput = document.getElementById('contact_person');

    const updateFormFields = (role) => {
        if (role === 'school' || role === 'ngo') {
            usernameLabel.textContent = 'Organization Name';
            usernameInput.placeholder = 'e.g., Springfield High School or Green NGO';
            contactPersonField.classList.remove('d-none');
            if (contactPersonInput) contactPersonInput.setAttribute('required', 'true');
        } else {
            usernameLabel.textContent = 'Your Username';
            usernameInput.placeholder = 'e.g., john_doe';
            contactPersonField.classList.add('d-none');
            if (contactPersonInput) contactPersonInput.removeAttribute('required');
        }
    };

    roleRadios.forEach(radio => {
        radio.addEventListener('change', () => {
            updateFormFields(radio.value);
        });
    });

    const selectedRole = document.querySelector('input[name="role"]:checked');
    if (selectedRole) {
        updateFormFields(selectedRole.value);
    } else {
        const defaultParentRadio = document.querySelector('input[name="role"][value="parent"]');
        if (defaultParentRadio) {
            defaultParentRadio.checked = true;
            updateFormFields('parent');
        }
    }
});
</script>
{% endblock %}
